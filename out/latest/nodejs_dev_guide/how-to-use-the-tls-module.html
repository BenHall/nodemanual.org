<!DOCTYPE html><!--[if lt IE 7]> <html class="no-js ie6 oldie" lang="en"> <![endif]-->
<!--[if IE 7]>    <html class="no-js ie7 oldie" lang="en"> <![endif]-->
<!--[if IE 8]>    <html class="no-js ie8 oldie" lang="en"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"> <!--<![endif]-->
<head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><title>Using TLS</title><meta name="generator" content="ndoc"><meta name="description" content=""><meta name="author" content=""><meta name="viewport" content="width=device-width,initial-scale=1"><!-- CSS--><link rel="stylesheet" href="../resources/csses/bootstrap.css"><link rel="stylesheet" href="../resources/csses/prettify.css"><link rel="stylesheet" href="../resources/csses/refguide_overrides.css"><link rel="stylesheet" href="../resources/csses/devguide_overrides.css"><!-- end CSS--><script src="../resources/javascripts/jquery.js"></script><script src="../resources/javascripts/clicker.js"></script><script src="../resources/javascripts/jquery.collapse.js"></script><script src="../resources/javascripts/jquery.cookie.js"></script><script src="../resources/javascripts/bootstrap-dropdown.js"></script></head><body onload="styleCode()"><div class="topbar"><div class="fill"><div id="topSection" class="container"><ul class="nav"><li data-dropdown="dropdown" class="dropdown"><a href="/" class="dropdown-toggle brand"><!--div(class="arrow-down")--></a><ul class="dropdown-menu"><li><a href="http://nodebits.org/">Nodebits</a></li></ul></li></ul><ul class="nav"><li id="node_js_ref"><a href="../nodejs_ref_guide/index.html">Node JS Reference</a></li><li id="nodejs_dev_guide"><a href="../nodejs_dev_guide/index.html">Node JS Manual</a></li><li id="js_doc"><a href="../js_doc/index.html">Javascript Reference</a></li></ul><form id="searchbox" action="" class="pull-right"><input name="query" type="text" placeholder="Search Documentation" title="Search across all the documentation types" class="span3"></form></div></div></div><header id="overview" class="jumbotron masthead"><div class="inner"><div class="container"><h1>Node.js Manual</h1><p class="lead"></p></div></div></header><div class="container"><div class="content"><div class="row container"><div class="span5 offset4 sidebarContainer"><div id="sidebar"><div id="well"><h2>Node.js Manual</h2><h3>Overview</h3><ul class="menu"><li><div class="menu-item"><a href="npm.html" class="menuLink">Node Package Manager</a></div><ul class="menuTwo"><li><div class="menu-item"><a href="how-to-access-module-package-info.html" class="menuLink class">Accessing Module Package Info</a></div></li><li><div class="menu-item"><a href="what-is-node-core-verus-userland.html" class="menuLink class">Nodecore versus Userland   </a></div></li><li><div class="menu-item"><a href="what-is-the-file-package-json.html" class="menuLink class">File Package JSON    </a></div></li></ul></li><li><div class="menu-item"><a href="what-is-require.html" class="menuLink">Understanding require()                            </a></div></li><li><div class="menu-item"><a href="how-to-use-nodejs-repl.html" class="menuLink">Execute Node.js on the Command Line with REPL</a></div></li><li><div class="menu-item"><a href="how-to-debug-nodejs-applications.html" class="menuLink">Debugging Node.js Applications    </a></div></li><li><div class="menu-item"><a href="how-to-use-util-inspect.html" class="menuLink">Debugging with Util.Inspect()         </a></div></li><li><div class="menu-item"><a href="how-to-write-asynchronous-code.html" class="menuLink">Writing Asynchronous Code                                                        </a></div></li><li><div class="menu-item"><a href="what-are-callbacks.html" class="menuLink">Understanding Callbacks</a></div></li><li><div class="menu-item"><a href="what-are-event-emitters.html" class="menuLink">Understanding Event Emitters</a></div></li></ul><h3>Tutorials</h3><ul class="menu"><li><div class="menu-item"><a href="how-to-create-default-parameters-for-functions.html" class="menuLink">Creating Default Parameters for Functions</a></div></li><li><div class="menu-item"><a href="what-is-the-arguments-object.html" class="menuLink">The Arguments Object         </a></div></li><li><div class="menu-item"><a href="how-to-log.html" class="menuLink">Logging</a></div></li><li><div class="menu-item"><a href="how-to-read-files-in-nodejs.html" class="menuLink">Reading Files            </a></div></li><li><div class="menu-item"><a href="how-to-write-files-in-nodejs.html" class="menuLink">Writing to Files               </a></div></li><li><div class="menu-item"><a href="what-are-the-built-in-timer-functions.html" class="menuLink">Using Timer Functions Correctly</a></div></li><li><div class="menu-item"><a href="how-to-get-colors-on-the-command-line.html" class="menuLink">Colors on the Command Line    </a></div></li><li><div class="menu-item"><a href="how-to-parse-command-line-arguments.html" class="menuLink">Parsing Command Line Arguments     </a></div></li><li><div class="menu-item"><a href="how-to-prompt-for-command-line-input.html" class="menuLink">Prompting for Command Line Input         </a></div></li><li><div class="menu-item"><a href="security.html" class="menuLink">Security     </a></div></li><li><div class="menu-item"><span class="menuLink">HTTP Servers and Clients</span></div><ul class="menuTwo"><li><div class="menu-item"><a href="HTTP-servers.html" class="menuLink">Creating an HTTP Server</a></div></li><li><div class="menu-item"><a href="how-to-create-a-HTTPS-server.html" class="menuLink">Creating an HTTPS Server</a></div></li><li><div class="menu-item"><a href="how-to-serve-static-files.html" class="menuLink">Serving Files                   </a></div></li><li><div class="menu-item"><a href="how-to-read-POST-data.html" class="menuLink">Reading POST Data</a></div></li><li><div class="menu-item"><a href="how-to-handle-multipart-form-data.html" class="menuLink">Handling Multi-Part Form Data</a></div></li><li><div class="menu-item"><a href="how-to-create-a-HTTP-request.html" class="menuLink">Creating HTTP GET and POST Requests                                 </a></div></li><li><div class="menu-item"><a href="how-to-access-query-string-parameters.html" class="menuLink">Accessing Query String Parameters             </a></div></li></ul></li><li><div class="menu-item"><a href="how-to-store-local-config-data.html" class="menuLink">Storing Local Data       </a></div></li><li><div class="menu-item"><a href="how-to-search-files-and-directories-in-nodejs.html" class="menuLink">Searching for Files     </a></div></li><li><div class="menu-item"><a href="how-to-use-the-path-module.html" class="menuLink">Using the path module</a></div></li><li><div class="menu-item"><a href="what-is-the-error-object.html" class="menuLink">The Error Object</a></div></li><li><div class="menu-item"><a href="what-is-try-catch.html" class="menuLink">Understanding try/catch</a></div></li><li><div class="menu-item"><a href="what-are-the-error-conventions.html" class="menuLink">Understanding the Error Conventions</a></div></li><li><div class="menu-item"><a href="how-to-spawn-a-child-process.html" class="menuLink">Spawning Child Processes</a></div></li><li><div class="menu-item"><span class="menuLink">Buffers</span></div><ul class="menuTwo"><li><div class="menu-item"><a href="how-to-use-buffers.html" class="menuLink">Using Buffers                  </a></div></li></ul></li><li><div class="menu-item"><a href="streams.html" class="menuLink">Understanding Streams</a></div><ul class="menuTwo"><li><div class="menu-item"><a href="how-to-use-fs-create-read-stream.html" class="menuLink">Using fs.createReadStream()     </a></div></li><li><div class="menu-item"><a href="how-to-use-fs-create-write-stream.html" class="menuLink">Using fs.createWriteStream()</a></div></li><li><div class="menu-item"><a href="how-to-use-stream-pipe.html" class="menuLink">Using the Stream Pipe                    </a></div></li></ul></li><li><div class="menu-item"><a href="how-to-create-a-custom-repl.html" class="menuLink">Creating a Custom REPL</a></div></li><li><div class="menu-item"><a href="cryptography.html" class="menuLink">Cryptography</a></div><ul class="menuTwo"><li><div class="menu-item"><a href="how-to-use-crypto-module.html" class="menuLink">Using the crypto Module    </a></div></li><li><div class="menu-item"><a href="how-to-use-the-tls-module.html" class="menuLink">Using the tls Module    </a></div></li></ul></li></ul><h3>Reference</h3><ul class="menu"><li><div class="menu-item"><a href="globals-in-node-js.html" class="menuLink">A (Brief) List of Globals in Node.js</a></div></li><li><div class="menu-item"><a href="the-process-module.html" class="menuLink">The Process Module    </a></div></li><li><div class="menu-item"><a href="the-console-module.html" class="menuLink">The Console Module      </a></div></li><li><div class="menu-item"><a href="what-is-json.html" class="menuLink">About JSON </a></div></li><li><div class="menu-item"><a href="what-are-truthy-and-falsy-values.html" class="menuLink">Defining "Truthy" and "Falsy" values</a></div></li><li><div class="menu-item"><a href="using-ECMA5-in-nodejs.html" class="menuLink">Using ECMA5 in Node.js           </a></div></li></ul></div></div></div><div class="span11"><div id="content" class="dev_guide"><p><div class='title'><a class="hiddenLink" id="using-tls"></a></p>  <h3>Using TLS</h3> <span class="cite">by Joshua Holbrook</span>

 <p></div>
<a href="http://en.wikipedia.org/wiki/Transport_Layer_Security">Transport Layer Security</a> (TLS) is the successor to Secure Sockets Layer (SSL). It, along with SSL, are the de-facto standard cryptographic protocols for secure communications over the web. TSL encrypts communications on top of a network transport layer (typically TCP), and uses public-key cryptography to encrypt messages.</p>  <Note>For more detailed information, see <a href="../nodejs_ref_guide/tls.html">the Node.js reference documentation on the <code>tls</code> module</a>.</Note>

 <a class="hiddenLink" id="publickey-cryptography"></a>

 <h4>Public-Key Cryptography</h4> <p>In public-key cryptography, each peer has two keys: a public key, and a private key. The public key is shared with everyone, and the private key is kept secret. In order to encrypt a message, a computer requires its private key and the recipient&apos;s public key. Then, in order to decrypt the message, the recipient requires its <em>own</em> private key and the <em>sender</em>&apos;s public key.</p>  <p>In TLS connections, the public key is called a <em>[certificate](http://en.wikipedia.org/wiki/Digital</em>certificate)<em>. This is because it&apos;s &quot;[signed](http://en.wikipedia.org/wiki/Digital</em>signature)&quot; to prove that the public key belongs to its owner. TLS certificates may either be signed by a third-party certificate authority (CA), or they may be <a href="http://en.wikipedia.org/wiki/Self-signed_certificate">self-signed</a>. In the case of Certificate Authorities, Mozilla keeps <a href="http://mxr.mozilla.org/mozilla/source/security/nss/lib/ckfw/builtins/certdata.txt">a list of trusted root CAs</a> that are generally agreed upon by most web browsers. These root CAs may then issue certificates to other signing authorities, which in turn sign certificates for the general public.</p>  <p>TLS support in Node.js is relatively new. The first stable version of Node.js to support TSL and HTTPS was the v0.4 branch, which was released in early 2011. As such, the TSL APIs in Node.js are still a little rough around the edges.</p>  <a class="hiddenLink" id="creating-a-tls-server"></a>

 <h4>Creating a TLS Server</h4> <p>In most ways, the TLS module&apos;s server API is similar to that of the net module. Besides the fact that it&apos;s for encrypted connections, the major difference is that the options object passed to <code>tls.connect()</code> or <code>tls.createServer()</code> needs to include information on both the private key and the certificate, in <a href="http://en.wikipedia.org/wiki/X.509#Certificate_filename_extensions">pem format</a>. </p>  <p>Here&apos;s an example of a TLS server:</p>  <pre><code>var tls = require(&apos;tls&apos;),
    fs = require(&apos;fs&apos;),
    msg = [
            &quot;.-..-..-.  .-.   .-. .--. .---. .-.   .---. .-.&quot;,
            &quot;: :; :: :  : :.-.: :: ,. :: .; :: :   : .  :: :&quot;,
            &quot;:    :: :  : :: :: :: :: ::   .&apos;: :   : :: :: :&quot;,
            &quot;: :: :: :  : `&apos; `&apos; ;: :; :: :.`.: :__ : :; ::_;&quot;,
            &quot;:_;:_;:_;   `.,`.,&apos; `.__.&apos;:_;:_;:___.&apos;:___.&apos;:_;&quot; 
          ].join(&quot;\n&quot;).cyan;

var options = {
  key: fs.readFileSync(&apos;private-key.pem&apos;),
  cert: fs.readFileSync(&apos;public-cert.pem&apos;)
};

tls.createServer(options, function (s) {
  s.write(msg+&quot;\n&quot;);
  s.pipe(s);
}).listen(8000);
</code></pre> <p>In this example, a &quot;hello world&quot; TLS server is created, listening on port 8000. The options object includes two properties: <code>key</code> and <code>cert</code>. The contents of these properties come directly from the private key and public certificate stored on the filesystem. In this case they are binary buffers, but the TLS module can also accept unicode strings.</p>  <a class="hiddenLink" id="generating-your-private-key-and-certificate-with-openssl"></a>

 <h4>Generating Your Private Key And Certificate With OpenSSL:</h4> <p>In order for this example server to work, of course, you will need a private key and a certificate. You can generate both of these with OpenSSL.</p>  <p>First, generate a private key:</p>  <pre><code>$ openssl genrsa -out private-key.pem 1024
Generating RSA private key, 1024 bit long modulus
......................................++++++
........++++++
e is 65537 (0x10001)</code></pre> <p>This creates a suitable private key and writes it to <code>./private-key.pem</code>.</p>  <p>Next, create a Certificate Signing Request file using your private key:</p>  <pre><code>$ openssl req -new -key private-key.pem -out csr.pem
You are about to be asked to enter information that will be incorporated
into your certificate request.
What you are about to enter is what is called a Distinguished Name or a DN.
There are quite a few fields but you can leave some blank
For some fields there will be a default value,
If you enter &apos;.&apos;, the field will be left blank.
-----
Country Name (2 letter code) [AU]:US
State or Province Name (full name) [Some-State]:California
Locality Name (eg, city) []:Oakland
Organization Name (eg, company) [Internet Widgits Pty Ltd]:Panco, Inc.
Organizational Unit Name (eg, section) []:
Common Name (eg, YOUR name) []:Joshua Holbrook
Email Address []:blah@boo.com

Please enter the following &apos;extra&apos; attributes
to be sent with your certificate request
A challenge password []:dangerface
An optional company name []:</code></pre> <p>The purpose of this CSR is to &quot;request&quot; a certificate. That is, if you wanted a CA to sign your certificate, you could give this file to them to process and they would give you back a certificate.</p>  <p>Alternately, however, you may self-sign your certificate, again using your private key:</p>  <pre><code>$ openssl x509 -req -in csr.pem -signkey private-key.pem -out public-cert.pem
Signature ok
subject=/C=US/ST=California/L=Oakland/O=Panco, Inc./CN=Joshua Holbrook/emailAddress=blah@boo.com
Getting Private key</code></pre> <p>This generates your certificate. Now you&apos;re cooking!</p>  <p>One way to test out your new &quot;hello world&quot; server is to again use OpenSSL:</p>  <pre><code>$ openssl s_client -connect 127.0.0.1:8000</code></pre> <p>You should see a bunch of output regarding the handshaking process, and then at the very end you should see a big, cyan figlet banner saying, &quot;Hi world!&quot;</p>  <a class="hiddenLink" id="connecting-to-a-tls-server"></a>

 <h4>Connecting to a TLS Server</h4> <p>The <code>tls</code> module also supplies tools for connecting to such a server:</p>  <pre><code>var tls = require(&apos;tls&apos;),
    fs = require(&apos;fs&apos;);

var options = {
  key: fs.readFileSync(&apos;private-key.pem&apos;),
  cert: fs.readFileSync(&apos;public-cert.pem&apos;)
};

var conn = tls.connect(8000, options, function() {
  if (conn.authorized) {
    console.log(&quot;Connection authorized by a Certificate Authority.&quot;);
  } else {
    console.log(&quot;Connection not authorized: &quot; + conn.authorizationError)
  }
    console.log();
});

conn.on(&quot;data&quot;, function (data) {
  console.log(data.toString());
  conn.end();
});</code></pre> <p>The idea is similar, except instead of creating a server, this script connects to one instead. <code>tls.connect()</code> also takes an <code>options</code> object, and then returns a stream.</p>  <p><code>tls.connect()</code> also fires a callback when the connection is made, which allows for checking to see if the connection is authorized&mdash;that is, if all the certificates are in order. <code>conn.authorized</code> is a boolean, and <code>conn.authorizationError</code> is a string containing the reason that the connection is unauthorized.</p>  <p>This is what happens when the client is run (with the server running):</p>  <pre><code>$ node client.js
Connection not authorized: DEPTH_ZERO_SELF_SIGNED_CERT

.-..-..-.  .-.   .-. .--. .---. .-.   .---. .-.
: :; :: :  : :.-.: :: ,. :: .; :: :   : .  :: :
:    :: :  : :: :: :: :: ::   .&apos;: :   : :: :: :
: :: :: :  : `&apos; `&apos; ;: :; :: :.`.: :__ : :; ::_;
:_;:_;:_;   `.,`.,&apos; `.__.&apos;:_;:_;:___.&apos;:___.&apos;:_;</code></pre> <p>Note that self-signing the server certificate results in a non-authorized status because you&apos;re not listed as a trusted certificate authority.</p>  <p>It&apos;s entirely possible to &quot;upgrade&quot; an existing tcp connection into a TLS-encrypted one with Node.js. However, Node.js does not have a special functions for doing so as of the v0.6 branch. Therefore, it needs to be done &quot;by-hand&quot;, using the crypto module and some undocumented <code>tls</code> module functionality. Node&apos;s documentation points to <a href="https://gist.github.com/848444">https://gist.github.com/848444</a>, which aims to abstract the process.</p></div><div id="disqus_thread"></div></div></div></div><footer id="footer"><div class="container"><div class="footer-text">Thanks to these content providers | &#169; 2012:</div><div class="sponsors"><a href="http://c9.io/" title="cloud9 ide" target="_blank" class="c9-logo sponsor"></a><a href="http://www.joyent.com/" title="joyent" target="_blank" class="joyent-logo sponsor"></a><a href="http://www.mozilla.org/" title="mozilla" target="_blank" class="mozilla-logo sponsor"></a><a href="http://nodejitsu.com/" title="nodejitsu" target="_blank" class="nodejitsu-logo sponsor"></a></div></div></footer></div><!-- scripts concatenated and minified via ant build script--><script defer src="../resources/javascripts/plugins.js"></script>
<script defer src="../resources/javascripts/prettify.js"></script>
<script defer src="../resources/javascripts/prettify-extension.js"></script>
<script defer src="../resources/javascripts/script.js"></script>
<script defer src="../resources/javascripts/disqus-ext.js"></script>
<!-- end scripts--><!--[if lt IE 7]><script src="//ajax.googleapis.com/ajax/libs/chrome-frame/1.0.3/CFInstall.min.js"></script><script>window.attachEvent('onload',function(){CFInstall.check({mode:'overlay'})})

</script><![endif]--></body></html>
