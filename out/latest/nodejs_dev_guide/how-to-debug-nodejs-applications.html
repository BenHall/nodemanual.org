<!DOCTYPE html><!--[if lt IE 7]> <html class="no-js ie6 oldie" lang="en"> <![endif]-->
<!--[if IE 7]>    <html class="no-js ie7 oldie" lang="en"> <![endif]-->
<!--[if IE 8]>    <html class="no-js ie8 oldie" lang="en"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"> <!--<![endif]-->
<head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><title>Debugging Node.js Applications</title><meta name="generator" content="ndoc"><meta name="description" content=""><meta name="author" content=""><meta name="viewport" content="width=device-width,initial-scale=1"><!-- CSS--><link rel="stylesheet" href="../resources/csses/bootstrap.css"><link rel="stylesheet" href="../resources/csses/prettify.css"><link rel="stylesheet" href="../resources/csses/refguide_overrides.css"><link rel="stylesheet" href="../resources/csses/devguide_overrides.css"><!-- end CSS--><script src="../resources/javascripts/jquery.js"></script><script src="../resources/javascripts/clicker.js"></script><script src="../resources/javascripts/jquery.collapse.js"></script><script src="../resources/javascripts/jquery.cookie.js"></script><script src="../resources/javascripts/bootstrap-dropdown.js"></script></head><body onload="styleCode()"><div class="topbar"><div class="fill"><div id="topSection" class="container"><ul class="nav"><li data-dropdown="dropdown" class="dropdown"><a href="#" class="dropdown-toggle brand"></a><ul class="dropdown-menu"><li><a href="http://nodebits.org/">Nodebits</a></li></ul></li></ul><ul class="nav"><li id="node_js_ref"><a href="../nodejs_ref_guide/index.html">Node JS Reference</a></li><li id="nodejs_dev_guide"><a href="../nodejs_dev_guide/index.html">Node JS Manual</a></li><li id="js_doc"><a href="../js_doc/index.html">Javascript Reference</a></li></ul><form id="searchbox" action="" class="pull-right"><input name="query" type="text" placeholder="Search Documentation" title="Search across all the documentation types" class="span3"></form></div></div></div><header id="overview" class="jumbotron masthead"><a href="http://c9.io/" title="cloud9 ide" target="_blank" class="c9-sponsor"></a><div class="inner"><div class="container"><h1>Node.js Manual</h1><p class="lead"></p></div></div></header><div class="container"><div class="content"><div class="row"><div class="span5 offset4"><div id="sidebar"><div id="well"><h2>Node.js Manual</h2><h3>Overview</h3><ul class="menu"><li><div class="menu-item"><a href="npm.html" class="menuLink">Node Package Manager</a></div><ul class="menuTwo"><li><div class="menu-item"><a href="how-to-access-module-package-info.html" class="menuLink class">Accessing Module Package Info</a></div></li><li><div class="menu-item"><a href="what-is-node-core-verus-userland.html" class="menuLink class">Nodecore versus Userland   </a></div></li><li><div class="menu-item"><a href="what-is-the-file-package-json.html" class="menuLink class">File Package JSON    </a></div></li></ul></li><li><div class="menu-item"><a href="what-is-require.html" class="menuLink">Understanding require()                            </a></div></li><li><div class="menu-item"><a href="how-to-use-nodejs-repl.html" class="menuLink">Execute Node.js on the Command Line with REPL</a></div></li><li><div class="menu-item"><a href="how-to-debug-nodejs-applications.html" class="menuLink">Debugging Node.js Applications    </a></div></li><li><div class="menu-item"><a href="how-to-use-util-inspect.html" class="menuLink">Debugging with Util.Inspect()         </a></div></li><li><div class="menu-item"><a href="how-to-write-asynchronous-code.html" class="menuLink">Writing Asynchronous Code                                                        </a></div></li><li><div class="menu-item"><a href="what-are-callbacks.html" class="menuLink">Understanding Callbacks</a></div></li><li><div class="menu-item"><a href="what-are-event-emitters.html" class="menuLink">Understanding Event Emitters</a></div></li></ul><h3>Tutorials</h3><ul class="menu"><li><div class="menu-item"><a href="how-to-create-default-parameters-for-functions.html" class="menuLink">Creating Default Parameters for Functions</a></div></li><li><div class="menu-item"><a href="what-is-the-arguments-object.html" class="menuLink">The Arguments Object         </a></div></li><li><div class="menu-item"><a href="how-to-log.html" class="menuLink">Logging</a></div></li><li><div class="menu-item"><a href="how-to-read-files-in-nodejs.html" class="menuLink">Reading Files            </a></div></li><li><div class="menu-item"><a href="how-to-write-files-in-nodejs.html" class="menuLink">Writing to Files               </a></div></li><li><div class="menu-item"><a href="what-are-the-built-in-timer-functions.html" class="menuLink">Using Timer Functions Correctly</a></div></li><li><div class="menu-item"><a href="how-to-get-colors-on-the-command-line.html" class="menuLink">Colors on the Command Line    </a></div></li><li><div class="menu-item"><a href="how-to-parse-command-line-arguments.html" class="menuLink">Parsing Command Line Arguments     </a></div></li><li><div class="menu-item"><a href="how-to-prompt-for-command-line-input.html" class="menuLink">Prompting for Command Line Input         </a></div></li><li><div class="menu-item"><a href="security.html" class="menuLink">Security     </a></div></li><li><div class="menu-item"><span class="menuLink">HTTP Servers and Clients</span></div><ul class="menuTwo"><li><div class="menu-item"><a href="HTTP-servers.html" class="menuLink">Creating an HTTP Server</a></div></li><li><div class="menu-item"><a href="how-to-create-a-HTTPS-server.html" class="menuLink">Creating an HTTPS Server</a></div></li><li><div class="menu-item"><a href="how-to-serve-static-files.html" class="menuLink">Serving Files                   </a></div></li><li><div class="menu-item"><a href="how-to-read-POST-data.html" class="menuLink">Reading POST Data</a></div></li><li><div class="menu-item"><a href="how-to-handle-multipart-form-data.html" class="menuLink">Handling Multi-Part Form Data</a></div></li><li><div class="menu-item"><a href="how-to-create-a-HTTP-request.html" class="menuLink">Creating HTTP GET and POST Requests                                 </a></div></li><li><div class="menu-item"><a href="how-to-access-query-string-parameters.html" class="menuLink">Accessing Query String Parameters             </a></div></li></ul></li><li><div class="menu-item"><a href="how-to-store-local-config-data.html" class="menuLink">Storing Local Data       </a></div></li><li><div class="menu-item"><a href="how-to-search-files-and-directories-in-nodejs.html" class="menuLink">Searching for Files     </a></div></li><li><div class="menu-item"><a href="how-to-use-the-path-module.html" class="menuLink">Using the path module</a></div></li><li><div class="menu-item"><a href="what-is-the-error-object.html" class="menuLink">The Error Object</a></div></li><li><div class="menu-item"><a href="what-is-try-catch.html" class="menuLink">Understanding try/catch</a></div></li><li><div class="menu-item"><a href="what-are-the-error-conventions.html" class="menuLink">Understanding the Error Conventions</a></div></li><li><div class="menu-item"><a href="how-to-spawn-a-child-process.html" class="menuLink">Spawning Child Processes</a></div></li><li><div class="menu-item"><span class="menuLink">Buffers</span></div><ul class="menuTwo"><li><div class="menu-item"><a href="how-to-use-buffers.html" class="menuLink">Using Buffers                  </a></div></li></ul></li><li><div class="menu-item"><a href="streams.html" class="menuLink">Understanding Streams</a></div><ul class="menuTwo"><li><div class="menu-item"><a href="how-to-use-fs-create-read-stream.html" class="menuLink">Using fs.createReadStream()     </a></div></li><li><div class="menu-item"><a href="how-to-use-fs-create-write-stream.html" class="menuLink">Using fs.createWriteStream()</a></div></li><li><div class="menu-item"><a href="how-to-use-stream-pipe.html" class="menuLink">Using the Stream Pipe                    </a></div></li></ul></li><li><div class="menu-item"><a href="how-to-create-a-custom-repl.html" class="menuLink">Creating a Custom REPL</a></div></li><li><div class="menu-item"><a href="cryptography.html" class="menuLink">Cryptography</a></div><ul class="menuTwo"><li><div class="menu-item"><a href="how-to-use-crypto-module.html" class="menuLink">Using the crypto Module    </a></div></li><li><div class="menu-item"><a href="how-to-use-the-tls-module.html" class="menuLink">Using the tls Module    </a></div></li></ul></li></ul><h3>Reference</h3><ul class="menu"><li><div class="menu-item"><a href="globals-in-node-js.html" class="menuLink">A (Brief) List of Globals in Node.js</a></div></li><li><div class="menu-item"><a href="the-process-module.html" class="menuLink">The Process Module    </a></div></li><li><div class="menu-item"><a href="the-console-module.html" class="menuLink">The Console Module      </a></div></li><li><div class="menu-item"><a href="what-is-json.html" class="menuLink">About JSON </a></div></li><li><div class="menu-item"><a href="what-are-truthy-and-falsy-values.html" class="menuLink">Defining "Truthy" and "Falsy" values</a></div></li><li><div class="menu-item"><a href="using-ECMA5-in-nodejs.html" class="menuLink">Using ECMA5 in Node.js           </a></div></li></ul></div></div></div><div class="span11"><div id="content" class="dev_guide"><p><div class='title'><a class="hiddenLink" id="debugging-node-js-applications"></a></p>  <h2>Debugging Node.js Applications</h2> <span class="cite">by Nico Reed</span>

 <p></div>
Often times, not just in the Node.js community but in software at large, people debug simply with a liberal sprinkle of standard output statements. This allows you to track down where unexpected values are being generated. However, this method can be tedious, or worse, not robust enough to detect real problems.</p>  <p>Thankfully, through the use of the <code>node-inspector</code> module, we can harness the power of webkit-debuggers to work with our Node.js code. The process itself is simple.</p>  <a class="hiddenLink" id="setting-up"></a>

 <h4>Setting up</h4> <p>First, ensure that node-inspector is installed:</p>  <pre><code>npm -g install node-inspector</code></pre> <p>Here&apos;s a good example application to experiment with, copied from the <code>node-inspector</code> repo. It is a &quot;hello world&quot; server with a counter :</p>  <pre><code>var http = require(&apos;http&apos;);
var x = 0;

http.createServer(function (req, res) {
    x += 1;
    res.writeHead(200, {&apos;Content-Type&apos;: &apos;text/plain&apos;});
    res.end(&apos;Hello World &apos; + x);
}).listen(8124);

console.log(&apos;Server running at http://127.0.0.1:8124/&apos;);</code></pre> <p>First, start the Node.js program with debugging enabled:</p>  <pre><code>node --debug app.js</code></pre> <p>This should print something along the lines of <code>debugger listening on port 5858</code> to stderr. Take note of the port number: it is the port that the debugger is running on.</p>  <p>Next, start up <code>node-inspector</code> in a separate command line window. By default, <code>node-inspector</code> uses port 8080, so you may want to pass it a custom port number with the <code>--web-port</code> option: If your program uses port 8080, then you may have to pass it a custom port.</p>  <pre><code>node-inspector --web-port=1123</code></pre> <p>Finally, start a Webkit browser (like Chrome or Safari), and go to <code>http://127.0.0.1:1123/debug?port=5858</code>. Here, 5858 represents the port the debugger is listening on, and 1123 represents your <code>node-inspector</code> webport. You may have to modify these values to match your environment.</p>  <p>At this point, you will be met with a fairly empty screen with the Scripts, Profiles, and Cnsole tabs.</p>  <a class="hiddenLink" id="scripts-tab"></a>

 <h4>Scripts tab</h4> <p>This tab is just like most Webkit debuggers. It has a list of all the Javascript files (including Node.js core and third-party libraries). You can select each one and dive into them.</p>  <p>To stop the interpreter on a specific line, set a breakpoint by clicking on the number of the desired line. When the execution is frozen, by a breakpoint or by manually pausing interpretation by pressing the pause button, you can check the callstack and examine all the local, closure, and global variables. You can also modify the code to try and fix the behavior. Note that when you modify the code through the Script tab, it does not get saved to the file, so you will need to transfer the modifications back by hand.</p>  <a class="hiddenLink" id="profiles-tab"></a>

 <h4>Profiles tab</h4> <p>To use the profile tab, you need a library called <code>v8-profiler</code>, which you can install with npm:</p>  <pre><code>npm install v8-profiler</code></pre> <p>Next, you have to require it inside the file you are debugging:</p>  <pre><code>var profiler = require(&apos;v8-profiler&apos;);</code></pre> <p>Now you can finally enable the <code>Profiles</code> tab. Unfortunately, all you can do from this screen is take a heap snapshot. From the code, you need to select where you want to start to CPU profiler. You can also select more precise location for heap snapshots.</p>  <p>To take a heap snapshot, just insert this line in the desired location and optionally pass it a name.</p>  <p>  var snapshot = profiler.takeSnapshot(name);</p>  <p>To take a CPU profile, just surround the code that you are profiling with the two lines shown below.  Optionally, a name can be included to indentify the cpu profile.</p>  <pre><code>profiler.startProfiling(name);
//..lots and lots of methods and code called..//
var cpuProfile = profiler.stopProfiling([name]);</code></pre> <p>As an example how to use these, here is the code from above, modified to take a CPU profile on every request, and take a heap snapshot after the server is created.</p>  <pre><code>var http = require(&apos;http&apos;);
var profiler = require(&apos;v8-profiler&apos;);

var x = 0;
http.createServer(function (req, res) {
    x += 1;
    profiler.startProfiling(&apos;request &apos;+x);
    res.writeHead(200, {&apos;Content-Type&apos;: &apos;text/plain&apos;});
    res.end(&apos;Hello World &apos; + x);
    profiler.stopProfiling(&apos;request &apos;+x);
}).listen(8124);

profiler.takeSnapshot(&apos;Post-Server Snapshot&apos;);
console.log(&apos;Server running at http://127.0.0.1:8124/&apos;);</code></pre> <p>Despite these APIs returning objects, it is much easier to sort through the data through the <code>node-inspector</code> interface. Hopefully, with these tools, you can make more informed decisions about memory leaks and bottlenecks.</p>  <a class="hiddenLink" id="console-tab"></a>

 <h4>Console tab</h4> <p>The console tab allows you to use Node&apos;s REPL in your program&apos;s global scope. This has a few caveats, since it means you can&apos;t access in local variables. Thus, the variables you <em>can</em> read or write are variables that were defined without a <code>var</code> statement. </p>  <p>The other exception is that when you use <code>console.log</code>, it refers to Node&apos;s <code>console.log</code>, and not webkit&apos;s <code>console.log</code>. This means the output goes to stdout and not to your console tab. </p>  <p>Other than these, it is a very straightforward Node.js REPL.</p></div><div id="disqus_thread"></div></div></div></div><footer id="footer"><div class="container"><div class="footer-text">Thanks to these content providors | &#169; 2012:</div><div class="sponsors"><a href="http://c9.io/" title="cloud9 ide" target="_blank" class="c9-logo"></a><a href="http://www.joyent.com/" title="joyent" target="_blank" class="joyent-logo"></a><a href="http://www.mozilla.org/" title="mozilla" target="_blank" class="mozilla-logo"></a><a href="http://nodejitsu.com/" title="nodejitsu" target="_blank" class="nodejitsu-logo"></a></div></div></footer></div><!-- scripts concatenated and minified via ant build script--><script defer src="../resources/javascripts/plugins.js"></script>
<script defer src="../resources/javascripts/prettify.js"></script>
<script defer src="../resources/javascripts/prettify-extension.js"></script>
<script defer src="../resources/javascripts/script.js"></script>
<script defer src="../resources/javascripts/disqus-ext.js"></script>
<!-- end scripts--><!--[if lt IE 7]><script src="//ajax.googleapis.com/ajax/libs/chrome-frame/1.0.3/CFInstall.min.js"></script><script>window.attachEvent('onload',function(){CFInstall.check({mode:'overlay'})})

</script><![endif]--></body></html>
