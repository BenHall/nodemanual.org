<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Node.js Developer's Guide</title>
    <meta name="description" content="">
    <meta name="author" content="">

    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le styles -->
    <link href="../css/bootstrap.css" rel="stylesheet">
    <link rel="stylesheet" href="../css/sh.css" type="text/css" />
    <style type="text/css">
      body {
        padding-top: 60px;
      }
    </style>
<link href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8/themes/base/jquery-ui.css" rel="stylesheet" type="text/css"/>
  <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.5/jquery.min.js"></script>
  <script src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8/jquery-ui.min.js"></script>
  <script src="../js/toc.js"></script>
    <script type="text/javascript">
    $(document).ready(function() {
        //$("#toc").accordion({ event: 'mouseover' }, { autoHeight: false });
    });
    </script>
    <link href="../css/style_override.css" rel="stylesheet">
  </head>

  <body>
    <!--
        <div class="topbar">
          <div class="topbar-inner">
            <div class="container-fluid">
              <a class="brand" href="#">Project name</a>
              <ul class="nav">
                <li class="active"><a href="#">Home</a></li>
                <li><a href="#about">About</a></li>
                <li><a href="#contact">Contact</a></li>
              </ul>
              <p class="pull-right">Logged in as <a href="#">username</a></p>
            </div>
          </div>
        </div>
    -->

    <div class="container-fluid">
      <div class="sidebar">
        <div id="toc" class="well">
        <h3>Overview</h3>
<div>
<ul>
<li><a class="upper" href="introduction.html">Introduction</a></li>
<li><a class="upper" href="npm.html">Node Package Manager</a></li>
<li><a class="upper" href="how-to-use-nodejs-repl.html">Execute Node.js on the Command Line with REPL</a></li>
<li><a class="upper" href="how-to-debug-nodejs-applications.html">Debugging Node.js Applications</a></li>
<li><a class="upper" href="how-to-write-asynchronous-code.html">Writing Asynchronous Code</a></li>
<li><a class="upper" href="what-are-callbacks.html">Understanding Callbacks</a></li>
<li><a class="upper" href="what-are-event-emitters.html">Understanding Event Emitters</a></li>
</ul>
</div>
<h3>Tutorial </h3>
<div>
<ul>
<li><a class="upper" href="what-are-the-built-in-timer-functions.html">Using Timer Functions Correctly</a></li>
<li><a class="upper" href="security.html">Security</a></li>
<li><a class="upper" href="HTTP-servers.html">Serving Files</a></li>
<li><a class="upper" href="how-to-store-local-config-data.html">Storing Local Data</a></li>
<li><a class="upper" href="how-to-search-files-and-directories-in-nodejs.html">Searching for Files</a></li>
<li><a class="upper" href="how-to-use-the-path-module.html">Using the path module</a></li>
<li><a class="upper" href="what-is-the-error-object.html">The Error Object</a></li>
<li><a class="upper" href="what-is-try-catch.html">Understanding try/catch()</a></li>
<li><a class="upper" href="what-are-the-error-conventions.html">Understanding the Error Conventions</a></li>
<li><a class="upper" href="how-to-spawn-a-child-process.html">Spawning Child Processes</a></li>
<li><a class="upper" href="buffers.html">Buffers</a></li>
<li><a class="upper" href="streams.html">Streams</a></li>
<li><a class="upper" href="how-to-create-a-custom-repl.html">Creating a Custom REPL</a></li>
<li><a class="upper" href="cryptography.html">Cryptography</a></li>
</ul>
</div>
<h3>Reference </h3>
<div>
<ul>
<li><a class="upper" href="globals-in-node-js.html">A (Brief) List of Globals in Node.js</a></li>
<li><a class="upper" href="the-process-module.html">The Process Module</a></li>
<li><a class="upper" href="the-console-module.html">The Console Module</a></li>
<li><a class="upper" href="what-is-json.html">About JSON</a></li>
<li><a class="upper" href="what-are-truthy-and-falsy-values.html">Defining "Truthy" and "Falsy" values</a></li>
</ul></div><li><a class="upper" href="using-ECMA5-in-nodejs.html">Using ECMA5 in Node.js</a></li>

</div>
</div>
<div class="content"><p><div class="hero-unit"></p>

<p><a class="hiddenLink" id="logging"></a></p>

<h3>Logging</h3>

<p><span class="cite">by Joshua Holbrook (Last Updated: Aug 26 2011)</span></p>

<p>Many processes, including most servers, write logs in one form or another. Some reasons for logging include debugging, keeping track of users and resource usage, and reporting application state.</p>

<h4>Simple Logging</h4>

<p>The simplest form of logging just involves using <code>console.log</code> or one of the other standard output methods. In this approach, any information is printed to <code>stdout</code> where it can either be read by the developer as it occurs, or, for example, redirected to a log file: </p>

<pre><code>console.log('Web Server started, waiting for connections...');
</code></pre>

<p>Because it's so simple, <code>console.log()</code> is by far the most common way of logging data in Node.js.</p>

<h4>Custom Logging</h4>

<p>Logging only with functions such as <code>console.log()</code> is not ideal for every use case, however.  Many applications have some sort of debugging mode, for example, that shows the user much more output than normal execution.  To do something like this, a better idea is to write your own simple logger, and use it instead of <code>console.log()</code>. </p>

<p>Here is an example of a basic custom logging module with configurable debugging levels:</p>

<pre><code>  var logger = exports;

  logger.log = function(level, message) {
    var levels = ['info', 'warn', 'error'];
    if (levels.indexOf(level) &gt;= levels.indexOf(logger.debugLevel) ) {
      if (typeof message !== 'string') {
        message = level + ": " + JSON.stringify(message);
      };

      console.log(message);
    }
  }
</code></pre>

<p>Save this code in a file called <code>logger.js</code>. You can then import this module, and use it like this:</p>

<pre><code>  var logger = require('./logger');
  logger.debugLevel = 'warn';
  logger.log('info', 'Everything started properly.');
  logger.log('warn', 'Running out of memory...');
  logger.log('error', { error: 'flagrant'});
</code></pre>

<p>Because <code>logger.debugLevel</code> was set to <code>warn</code>, the warning message and the error would both be displayed, but the <code>info</code> message would not be.</p>

<p>The advantage here is that the behavior of our logging mechanisms can now be modified and controlled from a central part of our code. In this case, logging levels were added, and messages are converted to JSON if they aren't already in string form. There is a lot more that could be done here&mdash;saving logs to a file, pushing them to a database, setting custom colors and formatting the output&mdash;but by the time you want that much functionality from your custom logging function, it might be time to use an already-existing library.</p>

<h4>Extended Logging Functionality</h4>

<p><a href="https://github.com/indexzero/winston">Winston</a> is a multi-transport and asynchronous logging library for Node.js.  It is conceptually similar to our custom logger, but comes with a wide variety of useful features and functionality baked in. In addition, <code>winston</code> is battle-hardened by internal use at <a href="http://nodejitsu.com/">Nodejitsu</a>.</p>

<p>Here's an example of setting up a <code>winston</code> logger.  This example includes most of the transports one could ever possibly want&mdash;most use cases will only warrant a few of these:</p>

<pre><code>  var winston = require('winston');

  require('winston-riak').Riak;
  require('winston-mongo').Mongo;
  var logger = new (winston.Logger)({
    transports: [
      new winston.transports.Console()
      new winston.transports.File({ filename: 'path/to/all-logs.log' })
      new winston.transports.Couchdb({ 'host': 'localhost', 'db': 'logs' })
      new winston.transports.Riak({ bucket: 'logs' })
      new winston.transports.MongoDB({ db: 'db', level: 'info'})
    ]
    exceptionHandlers: [
      new winston.transports.File({ filename: 'path/to/exceptions.log' })
    ]
  });
</code></pre>

<p>Here, we have instantiated a new <code>winston</code> logger, and provided a number of logging transports.  Winston has built-in support for configurable logging levels, and provides alias methods for each configured logging level.  For example, <code>winston.warn(x)</code> is an alias for <code>winston.log('warn', x)</code>.  Thus, the following:</p>

<pre><code>  logger.warn('Hull Breach Detected on Deck 7!'); 
</code></pre>

<p>Would output to the screen:</p>

<pre><code>  warn: Hull Breach Detected on Deck 7!
</code></pre>

<p>Because of the file transport we set up, winston also logged the warning to 'somefile.log'.  After the <code>logger.warn</code> call we just used, the log file, <code>somefile.log</code>, would contain the following output:</p>

<pre><code>  $ cat somefile.log 
  {'level':'warn','message':'Hull Breach Detected on Deck 7!'}
</code></pre>

<p>Note that winston's file logger formats the logs differently for file logging (JSON in this case) than it does for the console transport.</p>

<p>Winston also supports logging to Riak, CouchDB, MongoDB and even <a href="http://loggly.com">Loggly</a>.  The <code>logger.warn()</code> call we used before also put the same message into each database, according to the options we gave to each transport.</p>

<p>For further information, please see the <a href="https://github.com/indexzero/winston">thorough documentation for Winston</a>.<br /></div></p></div>
</div>
<footer>
    <p>&nbsp;</p>
</footer>
        
<script type="text/javascript" src="../js/sh_main.js"></script>
<script type="text/javascript" src="../js/sh_javascript.min.js"></script>
<!--<script type="text/javascript" src="../js/toc.js"></script>-->
</div>
    </div>

  </body>
</html>